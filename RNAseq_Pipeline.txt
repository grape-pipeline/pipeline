
  RNAseq Pipeline


      From GenomeWiki

Jump to: navigation <#column-one>, search <#searchInput>


    Contents

[hide <javascript:toggleToc()>]

    * 1 Overview <#Overview>
    * 2 Preprocessing <#Preprocessing>
    * 3 Some issues <#Some_issues>
    * 4 Initiation of the pipeline <#Initiation_of_the_pipeline>
    * 5 Pipeline execution <#Pipeline_execution>
    * 6 Pipeline Rules <#Pipeline_Rules>
    * 7 Presentations <#Presentations>
    * 8 FAQ <#FAQ>
    * 9 TO DO <#TO_DO>


    [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=1>]
    Overview

The pipeline is formed mainly by two scripts, a configuration script:
*start_RNAseq_pipeline.2.0.pl* and an execution script:
*execute_RNAseq_pipeline.pl* and a *template file* containing the tree
of commands to be executed. In order to run it three things are required
a genomic sequence, an annotation in gtf/gff format and, of course, the
set of reads which are to be mapped in gzipped fasta or fastq format.

In addition to this access to a *MySQL* database is needed and both *R*
and *(La)TeX* should be installed.


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=2>]
  Preprocessing

There is a preprocessing script that may be used if needed.
preproces.RNAseq.pl It will transform solexa _seq.txt(.gz) and
_qseq.txt(.gz) into fasta and fastq respectively, it can also separate
the two members of the pair when a paired in the run is given in a
single file. Pro this you need to use tne -paired option. It can also
filter out those cases with more than a specified number of ambiguous
bases (N's), as these will not be mapped anyway if the mapper allows
less mismatches, this can accelerate the mapping step, however in the
case of paired end reads it may not be a good idea as some reads may be
recovered thanks to their mate even if they have a large number of
mismatches, also GEM can ignore low quality mismatches without
penalizing the search speed.

Filtering of the read file is only done if a mismatch option is
provided, in which case the reads with more ambiguous bases are excluded
from the filtered file for fasta data and those with more that twice
that number of ambiguous bases in the case of fastq data

Once the fasta or fasq files are generated they need to be gzipped
before running the pipeline.


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=3>]
  Some issues

Currently this work is under developement, so not everything is as nice
as it hopefully will be at some point. Because of this there is
currently a couple of things that must be done when running the pipeline
tha hopefully will be automated in the future.

    * Create an empty directory that will be the base directory. This is
      the directory within which the pipeline scripts should be executed
    * Create within the base directory a subdirectory named readData
    * Put the files that contain the sequence data in gzipped fasta/q
      format in the readData directory within the base dir (note: the
      file names have to contain the string 'fastq'! to be identified as
      such)
    * Create a soft link in the base directory to the scripts that will
      run the workflow. This is currently in ~Projects/RNAseq_analysis_pipe
    * Run the start pipeline script with whatever options you need for
      your dataset.
    * Edit the read.list.txt file in a manner such that it results in
      three columns separated by tabs. The first column is the name of
      the files to be mapped (without the .gz), the second column is the
      name of the pair, and the third is the name of the lane. These
      identifiers will be the ones used in the plots produced, so it is
      nice if they are short but informative. In paired end reads the
      name of the pair should be the same for both members of a pair, as
      this is the info the pipeline will use to pair them. In single
      ends the second and third columns must be the same (for the moment). 

An optional fourth column is possible in thes case the new column is the
name of the sample, and it means all the datasets with the same sample
id will be grouped together in order to calculate an overall rpkm for
exons and genes

Filename 	Pair ID 	Lane ID 	Group ID
090813_s_7_1_seq_GFD-1.fastq 	GFD-1 	GFD-1.1 	Sample1
090813_s_7_2_seq_GFD-1.fastq 	GFD-1 	GFD-1.2 	Sample1


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=4>]
  Initiation of the pipeline

First create a directory and within it run the script
start_RNAseq_pipeline.pl with the required options. This step will do
the following tasks:

    * Use the template3.txt file to create the driving file of the
      pipeline according to the options provided
    * Initialize the different tables required in the provided database.
    * Create the directory structure required for the pipeline. 

The general syntax of the starting script is:
start_RNAseq_pipeline.2.0.pl -g path_to_genome -s species -readlength ?
-a path_to_annotation -prefix ? -template
/users/rg/dgonzalez/Projects/RNAseq_analysis_pipe/template2.0.txt -paired ?

The available options that may be given to the initiation script are
(the ones in bold are necessary, although not all mandatory as some may
be guessed by the script):

    * [*-species|s*]: Species for which the pipeline is run. Mandatory
    * [*-project*]: Name of the project. This is used to generate a
      unique prefix as well as to relate different experimetns from the
      same project
    * [*-experiment*]: Name of the experiment. This is used to generate
      a unique prefix as well as to relate to the project
    * [-help]: Prints a help message and exits and exits
    * [-man]: Prins a slightly more detailed help message and exits
    * [-template]: Name of the template file containing the commands
      that will be executed. Defaults to the file template.txt in the
      working directory if not provided
    * [-database]: Sets the database to use for the experiment specific
      results. Defaults to RNAseqPipeline.
    * [-commondb]: Sets the database to use to store the information
      that may be shared between projects and experiments. Defaults to
      RNAseqPipelineCommon.
    * [*-annotation*]: File with the annotation to use. Mandatory.
    * [*-genome*]: File with the genomic sequence. Mandatory.
    * [-mismatches]: Number of mismatches with which the mapping will be
      done. Default 2.
    * [-localdir]:Directory in which to store the temporary files
      generated during the pipeline run.
    * [-genomeindex]:Index to use instead of generating the index from
      the genome
    * [-transcriptomeindex]:Index to use instead of generating the index
      from the transcriptome
    * [-junctionsindex]:Index to use instead of generating the index
      from the junctions
    * [-exonsfasta]:Location where a multifasta Exons file can be found.
      If not it will be generated
    * [-junctionsfasta]:Location where a multifasta Junctions file can
      be found. If not it will be generated
    * [-transcriptomefasta]:Location where a multifasta Transcripts file
      can be found. If not it will be generated
    * [*-prefix*]: Prefix for the tables corresponding to this project.
    * [-exclusionfile]: Location of a file containing a list of exons
      and the exclusion junctions corresponding to each of them. It will
      be generated if missing.
    * [-debug|d]: Increases the verbosity a bit
    * [-clean]: Drops all the tables corresponding to the project that
      exist in the database
    * [-paired]: Reads are paired. Default 0 (single). Make sure the
      pairs are added correctly in the read.list.txt file
    * [-stranded]: Reads are stranded. Default 0 (not stranded).
    * [*-readlength*]: Nucleotide length of the reads. Mandatory
    * [-host]: Name of the host where the MySQL database is running.
      Defaults to rusc
    * [-junctionstable]: Name of the table containing the junctions. If
      missing will be generated
    * [-junctionsclass]: Name of the table containing the junctions
      classification. If missing will be generated
    * [-exonsclass]: Name of the table containing the exons
      classification. If missing will be generated
    * [-files]: Name of the file containing a list of the files to be
      mapped. This file should contain three tab separated fields
      containing the name of the file, which should be in fastq format
      and located in the readData directory, the name of the pair to
      which the file belongs if paired data, or the name of the lane if
      not, and finally the name of the lane (same as previous field if
      single data). If missing will be generated, but only with the
      files in the readData Directory. the second and third fields have
      to be eddited manually
    * [-threads]: Number of threads to be used by GEM (or any other step
      capable of using multiple CPUs). Defaults to 2
    * [-mapper]: Mapper to be used. Defaults to GEM 

After this put the sequences in fasta or fastq format in the readData
directory that has been created and gzip them (this has been done so we
don't use up so much space, even though it slightly slows down the process)

The necessary execution scripts must be copied or linked into the
generated bin directory, this is not yet done automatically.

Once this is done run the command:

execute_RNAseq_pipeline.pl [Prefix]_start


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=5>]
  Pipeline execution

After this initial step any of the other rules within the pipeline can
be executed using the same syntax:

execute_RNAseq_pipeline.pl rulename

The pipeline will automatically check for any proerequisites to this
rule and execute them consecutively until it reaches it. The
[Prefix]_start rule is the first rule. In addition tpo this any other
rule that contains an @ as a preqrequisite will not be executed unless
forced by using the -r switch (this is why the switch is used for
executing [Prefix]_start)

The options that may be passed to the execution script are:

    * -h: Print help and exit
    * -f: Control file name. This is the file that contains the
      steps/commands to be executed by the pipeline, it defaults to
      RNAseq_pipeline.txt
    * -n: Print commands that would be executed but don't execute them
    * -s: Silent (output is redirected to '/dev/null')
    * -d: Debug (be more verbose)
    * -r: Restart (force execution of rule). When this option is used
      the rule is forced to execute without any prerequisite checks, so
      no previous rule will be executed. 


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=6>]
  Pipeline Rules

The Pipeline is organized as a makefile, and each rule within it
executes a certain step in the pipeline. A step can depend on previous
steps or not, if it does the script execute_RNAseq_pipeline.pl will
check recursively the rules it repends on and rerun any case in which a
rule depends on another that has been executed more recently. The time
of execution is evaluated by looking at the MySQL databas, as each rule
that produces a table will have a timestamp in the database. Thos that
do not prodice tables are always executed unless they have an @ as a
requrement, in which case they will only be executed if forced by the -r
option.

If you want to you an add commands to the RNAseq_pipline.txt, These can
be any type of commands you could potentially execute on the command
line, however this file is recreated everytime the start script is run,
so make sure you save a copy somewhere else.


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=7>]
  Presentations


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=8>] FAQ

The following is a little collection of solutions for certain errors
people came across.


*error: "Problem with someAssemblyName.blf; someAssemblyName Is not a
valid index"*

As part of the mapping the pipeline creates indices for a given genome
assembly and annotation (junction, transcriptome and genome) and stores
their location in the database (table: fasta_files).To save resources
these indices get reused every time the same assembly/ annotation
combination is used. To fix the error you first have to check whether
the index exists at all. If this is not the case, delete the entry from
the database and rerun the start_RNAseq_pipeline.pl to recreate the index.

mysql MY_PIPELINE_DATABASE select * from fasta_files; delete from
fasta_files where
location="/some_path/the_index_file_that_doesnt_exist"; exit;

*Repeating steps*

In most cases any step that is up to date can be repeated using the -r
option, however for some steps that are very time consuming such as the
mapping steps and the coverage steps, you will need to remove any
mapping or overlap files respectively that they would have generated.
The reason for this is that the step itself steps for the existence of
the file and will not recreate it if already present. This feature
avoids having to repeat heavy computations in cases where the workflow
was interrupted.


  [edit </wiki/index.php?title=RNAseq_Pipeline&action=edit&section=9>] TO DO

Pooled inclusion values add the annotation tables for genes and
transcripts to the common db build all the required files for the we
automatically

Retrieved from "http://genome.crg.es/wiki/index.php/RNAseq_Pipeline"


          Views

    * Article </wiki/index.php/RNAseq_Pipeline>
    * Discussion </wiki/index.php?title=Talk:RNAseq_Pipeline&action=edit>
    * Edit </wiki/index.php?title=RNAseq_Pipeline&action=edit>
    * History </wiki/index.php?title=RNAseq_Pipeline&action=history>


          Personal tools

    * 172.17.32.120 </wiki/index.php/User:172.17.32.120>
    * Talk for this IP </wiki/index.php/User_talk:172.17.32.120>
    * Log in / create account
      </wiki/index.php?title=Special:Userlogin&returnto=RNAseq_Pipeline>

</wiki/index.php/Main_Page>


          Navigation

    * Main Page </wiki/index.php/Main_Page>
    * Community portal </wiki/index.php/GenomeWiki:Community_Portal>
    * Current events </wiki/index.php/Current_events>
    * Recent changes </wiki/index.php/Special:Recentchanges>
    * Random page </wiki/index.php/Special:Random>
    * Help </wiki/index.php/Help:Contents>
    * Donations </wiki/index.php/GenomeWiki:Site_support>


          Search

 


          Toolbox

    * What links here
      </wiki/index.php/Special:Whatlinkshere/RNAseq_Pipeline>
    * Related changes
      </wiki/index.php/Special:Recentchangeslinked/RNAseq_Pipeline>
    * Upload file </wiki/index.php/Special:Upload>
    * Special pages </wiki/index.php/Special:Specialpages>
    * Printable version
      </wiki/index.php?title=RNAseq_Pipeline&printable=yes>
    * Permanent link </wiki/index.php?title=RNAseq_Pipeline&oldid=1899>

Powered by MediaWiki <http://www.mediawiki.org/>

    * This page was last modified 10:22, 27 July 2010.
    * This page has been accessed 163 times.
    * Privacy policy </wiki/index.php/GenomeWiki:Privacy_policy>
    * About GenomeWiki </wiki/index.php/GenomeWiki:About>
    * Disclaimers </wiki/index.php/GenomeWiki:General_disclaimer>

